<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Test téléchargement public</title>
  <style>body{font-family:Arial;margin:40px;text-align:center}button{padding:12px 20px;font-size:16px}</style>
</head>
<body>
  <h1>Test téléchargement (bucket public)</h1>
  <p>Fichier : <strong>pdf_5f2a3b7c9d8e4f1a.pdf</strong> (bucket: ebooks)</p>
  <button id="dl">Télécharger</button>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const supabaseUrl = "https://unzbrvdybxwmrdhftgfm.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVuemJydmR5Ynh3bXJkaGZ0Z2ZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2ODY3MTgsImV4cCI6MjA3OTI2MjcxOH0.SWUuoDpsca8oWFnbQPvvHN1ROqn0wyTJNTKfENzNXys";
    const supabase = createClient(supabaseUrl, supabaseKey);

    document.getElementById('dl').addEventListener('click', async () => {
      try {
        const { data, error } = await supabase.storage
          .from('ebooks')
          .download('pdf_5f2a3b7c9d8e4f1a.pdf');

        if (error) throw error;

        const url = URL.createObjectURL(data);
        const a = document.createElement('a');
        a.href = url;
        a.download = "Le_Grimoire_Ultime_des_Pouvoirs.pdf";
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      } catch (err) {
        alert("Erreur: " + (err.message || err));
        console.error(err);
      }
    });
  </script>
</body>
</html>
